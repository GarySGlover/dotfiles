#+title: My Emacs Config
#+author: Gary Glover
#+property: header-args :results silent
#+STARTUP: content

* General Settingss
** Lexical Binding
Configure lexical binding for the rest of this init. A lexically-bound variable
has lexical scope, meaning that any reference to the variable must be
located textually within the binding construct.

This must be kept as the first entry in this list as documented in
"(elisp)Using Lexical Binding".

#+begin_src emacs-lisp :tangle yes
  ;; -*- lexical-binding: t -*-
#+end_src

** Byte compiler warnings
Silence the byte compiler warnings but still log. This is to prevent
Emaccs always displaying the \ast{}Warnings\ast{} buffer on startup.

#+begin_src emacs-lisp :tangle yes
  (use-package
   comp
   :custom native-comp-async-report-warnings-errors 'silent)
#+end_src

** Disable package downloads
Remove elpa from the package archives so that no packages will be
automatically downloaded. All packages will be installed using the nix
package manager.

#+begin_src emacs-lisp :tangle yes
  (use-package package
    :custom
    (package-archives nil "Remove all package download locations"))
#+end_src

* Performance Settings

* Key Bindings
** Meow
This is the meow modal editing suite.

#+begin_src emacs-lisp :tangle yes
  (use-package
    meow
    :init (meow-global-mode 1)
    :config
    (add-to-list 'meow-selection-command-fallback '(meow-replace . meow-yank))
    (setopt
     meow-cheatsheet-layout meow-cheatsheet-layout-qwerty
     meow-use-clipboard t)
    ;; Set keys for MOTION state. This is the state used in read-only style buffers like dired/help/magit
    (meow-motion-overwrite-define-key
     '("h" . meow-left)
     '("j" . meow-next)
     '("k" . meow-prev)
     '("l" . meow-right)
     '("r" . cloveynit-global-dispatch)
     '("<escape>" . ignore))
    (meow-leader-define-key
     ;; Allow SPC h/j/k/l to run the original command that will be bound to H-<h/j/k/l>
     '("h" . "H-h")
     '("j" . "H-j")
     '("k" . "H-k")
     '("l" . "H-l")
     '("r" . "H-r")
     ;; Use SPC (0-9) for digit arguments.
     '("1" . meow-digit-argument)
     '("2" . meow-digit-argument)
     '("3" . meow-digit-argument)
     '("4" . meow-digit-argument)
     '("5" . meow-digit-argument)
     '("6" . meow-digit-argument)
     '("7" . meow-digit-argument)
     '("8" . meow-digit-argument)
     '("9" . meow-digit-argument)
     '("0" . meow-digit-argument)
     ;; Use SPC //? for accessing meow help
     '("/" . meow-keypad-describe-key)
     '("?" . meow-cheatsheet))
    (meow-normal-define-key
     '("0" . meow-expand-0)
     '("9" . meow-expand-9)
     '("8" . meow-expand-8)
     '("7" . meow-expand-7)
     '("6" . meow-expand-6)
     '("5" . meow-expand-5)
     '("4" . meow-expand-4)
     '("3" . meow-expand-3)
     '("2" . meow-expand-2)
     '("1" . meow-expand-1)
     '("-" . negative-argument)
     '(";" . meow-reverse)
     '("," . meow-inner-of-thing)
     '("." . meow-bounds-of-thing)
     '("[" . meow-beginning-of-thing)
     '("]" . meow-end-of-thing)
     '("a" . meow-append)
     '("A" . meow-open-below)
     '("b" . meow-back-word)
     '("B" . meow-back-symbol)
     '("c" . meow-change)
     '("d" . meow-delete)
     '("D" . meow-backward-delete)
     '("e" . meow-next-word)
     '("E" . meow-next-symbol)
     '("f" . meow-find)
     '("g" . meow-cancel-selection)
     '("G" . meow-grab)
     '("h" . meow-left)
     '("H" . meow-left-expand)
     '("i" . meow-insert)
     '("I" . meow-open-above)
     '("j" . meow-next)
     '("J" . meow-next-expand)
     '("k" . meow-prev)
     '("K" . meow-prev-expand)
     '("l" . meow-right)
     '("L" . meow-right-expand)
     '("m" . meow-join)
     '("n" . meow-search)
     '("o" . meow-block)
     '("O" . meow-to-block)
     '("p" . meow-replace)
     '("q" . meow-quit)
     '("r" . cloveynit-global-dispatch)
     '("R" . meow-swap-grab)
     '("s" . meow-kill)
     '("t" . meow-till)
     '("u" . meow-undo)
     '("U" . meow-undo-in-selection)
     '("v" . meow-visit)
     '("w" . meow-mark-word)
     '("W" . meow-mark-symbol)
     '("x" . meow-line)
     '("X" . meow-goto-line)
     '("y" . meow-save)
     '("Y" . meow-sync-grab)
     '("z" . meow-pop-selection)
     '("'" . repeat)
     '("<escape>" . ignore)))
#+end_src
** General
#+begin_src emacs-lisp :tangle yes
  (use-package general
    :init
    (general-define-key
     :keymaps 'global-map
     "<f5>" #'standard-themes-toggle
     "M-S" #'vertico-suspend
     "C-." #'embark-act)
    (with-eval-after-load 'corfu-candidate-overlay
      (general-define-key
       :keymaps 'corfu-candidate-overlay-completion-map
       "C-n" #'completion-at-point
       "<tab>" #'corfu-candidate-overlay-complete-at-point))
    (with-eval-after-load 'transient
      (general-define-key
       :keymaps 'transient-base-map
       "<escape>" 'transient-quit-all))
    (with-eval-after-load 'dired
      (general-define-key
       :keymaps 'dired-mode-map
       "?" 'cloveynit-dired-dispatch
       "C-t" 'cloveynit-dired-image-dired
       "%" 'cloveynit-dired-regexp
       "*" 'cloveynit-dired-marking)))
#+end_src
** TODO Transient
Transient allows the creation and mapping of keybindings through
menus. Initial configuration is to tie into meow, having a
global-dispatch map available in all buffers that links to custom
package maps. In the future I shall try to create a local mode map
that applies to certian major/minor modes.

#+begin_src emacs-lisp :tangle yes
  (use-package transient
    :init
    (transient-define-prefix cloveynit-global-dispatch ()
      "Global transient menu"
      [["Default"
        ("a" "Generic" cloveynit-global-generic-dispatch)
        ("c" "Consult" cloveynit-consult-dispatch)
        ("g" "Magit" magit-dispatch)
        ("h" "Help" cloveynit-helpful-dispatch)
        ("l" "Gptel" gptel-menu)
        ("n" "Denote" cloveynit-denote-dispatch)
        ("p" "Project" cloveynit-project-dispatch)
        ("m" "Modes" cloveynit-modes-dispatch)
        ("w" "Window" cloveynit-window-dispatch)
        ]]))
#+end_src
*** Place holder transients
#+begin_src emacs-lisp :tangle yes
  (transient-define-prefix cloveynit-modes-dispatch ()
    "Transient for toggling minor modes"
    [["Modes"
      ]])

  (transient-define-prefix cloveynit-window-dispatch ()
    "Transient for managing windows"
    [["Windows"
      ]])

#+end_src
*** Global generic transient
This transient is to provide a place for common commands, that don't
fit in as part of any other group.
#+begin_src emacs-lisp :tangle yes
  (transient-define-prefix cloveynit-global-generic-dispatch ()
    "Global generic transient"
    [["Narrowing"
      ("n" "Narrow" narrow-to-region)
      ("w" "Widen" widen :if (buffer-narrowed-p))]])
#+end_src
* UI Enhancements
** Basic display changes
#+begin_src emacs-lisp :tangle yes
  (setopt
   scroll-bar-mode nil
   tool-bar-mode nil
   menu-bar-mode nil)
#+end_src
** Theme
#+begin_src emacs-lisp :tangle yes
  (use-package standard-themes
    :init
    (standard-themes-load-dark)
    :custom
    (standard-themes-bold-constructs t)
    (standard-themes-italic-constructs t)
    (standard-themes-mixed-fonts t)
    (standard-themes-variable-pitch-ui t)
    (standard-themes-prompts '(extrabold italic)))
#+end_src
** Vertico
Vertico provides a minimalistic vertical completion interface for
Emacs, making it easier to navigate and select from a list of
candidates. It is efficient, supports cycling through options, and
integrates well with other packages like Consult and Marginalia.
#+begin_src emacs-lisp :tangle yes
  (use-package vertico
    :commands (vertico-mode vertico-suspend)
    :init (vertico-mode)
    :config
    (setopt
     enable-recursive-minibuffers t
     vertico-cycle t))
#+end_src
*** Multiform
Allows for the setting of different display forms for Vertico for
individual commmands or categories
#+begin_src emacs-lisp :tangle yes
  (use-package vertico-multiform
    :after vertico
    :commands (vertico-multiform-mode)
    :init (vertico-multiform-mode)
    :config
    (setopt vertico-multiform-commands
	    '((consult-line buffer)))
    (setopt vertico-multiform-categories
	    '((consult-grep buffer))))
#+end_src
** Orderless
#+begin_src emacs-lisp :tangle yes
  (use-package orderless
    :config
    (setopt
     completion-styles '(orderless basic)
     completion-category-defaults nil
     completion-category-overrides '((file (styles basic partial-completion)))))
#+end_src

** Corfu
Corfu is an extension for complete at point that dissplays in a popup
instead of in the minibuffer. This is similar to intellisense in other
editors.
#+begin_src emacs-lisp :tangle yes
  (use-package corfu
    :config
    (setopt
     corfu-auto t
     corfu-cycle t)
    :bind (:map corfu-map
                ("RET" . nil))
    :init (setopt global-corfu-mode t))
#+end_src
*** Overlay
#+begin_src emacs-lisp :tangle no
  (use-package corfu-candidate-overlay
    :after corfu
    :init
    (setq corfu-candidate-overlay-completion-map
	  (make-sparse-keymap))
    :config
    (corfu-candidate-overlay-mode +1)
    (defun corfu-candidate-overlay-completion-map--enable
	(position prefix candidate how-many-candidates)
      (unless
	  (= 0
	     (length candidate))
	(set-transient-map corfu-candidate-overlay-completion-map)))
    (advice-add 'corfu-candidate-overlay--update :after #'corfu-candidate-overlay-completion-map--enable))
#+end_src
*** Popup Info
Extension for Corfu that displays the information for a completion
candidate in a popup.
#+begin_src emacs-lisp :tangle yes
  (use-package corfu-popupinfo
    :after corfu
    :hook (global-corfu-mode . corfu-popupinfo-mode))
#+end_src

** Fonts
Set default font to be used with general text.
Use a coding font for fixed pitch and overwrite the default font in prog-mode buffers to
use the same.
#+begin_src emacs-lisp :tangle yes
  (defun cc/global-face ()
    (set-face-attribute 'default nil :family "FiraCode Nerd Font")
    (set-face-attribute 'fixed-pitch nil :family "FiraCode Nerd Font")
    (set-face-attribute 'fixed-pitch-serif nil :family "FiraCode Nerd Font")
    (set-face-attribute 'variable-pitch nil :family "FiraCode Nerd Font"))

  (defun cc/text-face ()
    (setq buffer-face-mode-face '(:family "Iosevka"))
    (buffer-face-mode))

  (if (daemonp)
      (add-hook 'server-after-make-frame-hook
                (lambda (frame)
                  (with-selected-frame frame
                    (cc/global-face))))
    (cc/global-face))

  (add-hook 'text-mode-hook #'cc/text-face)
#+end_src
** Consult
#+begin_src emacs-lisp :tangle yes
  (use-package consult
    :init
    (setopt
     xref-show-xrefs-function #'consult-xref
     xref-show-definitions-function #'consult-xref))

  (transient-define-prefix cloveynit-consult-dispatch ()
    "Transient for Consult commands"
    [["Buffers"
      ("b" "Switch" consult-buffer)
      ("o" "Other window" consult-buffer-other-window)
      ("j" "Project" consult-project-buffer)]
     ["Editing"
      ("y" "Yank" consult-yank-from-kill-ring)
      ("p" "Pop" consult-yank-pop)
      ("r" "Replace" consult-yank-replace)
      ("k" "KMacro" consult-kmacro)]
     ["Navigation"
      ("t" "Goto line" consult-goto-line)
      ("m" "Mark" consult-mark)
      ("M" "Global mark" consult-global-mark)
      ("i" "imenu" consult-imenu :if-not-derived org-mode)
      ("i" "Org Heading" consult-org-heading :if-derived org-mode)
      ("n" "imenu multi" consult-imenu-multi)]
     ["Search"
      ("l" "Line" consult-line)
      ("L" "Line multi" consult-line-multi)
      ("e" "Keep lines" consult-keep-lines)
      ("c" "Focus" consult-focus-lines)] ; Need to account for showing again, call with C-u prefix
     ["Find"
      ("g" "Grep" consult-ripgrep)
      ("G" "Git grep" consult-git-grep)
      ("f" "Find" consult-fd)]
     ])
#+end_src
** TODO [#C] Indent Bars
** TODO [#C] Rainbow delimaters
** Keycast
Display the keys pressed and the associated command in the header line.
#+begin_src emacs-lisp :tangle yes
  (use-package keycast
    :commands  (keycast-header-line-mode)
    :init (keycast-header-line-mode))
#+end_src
** TODO [#B] Embark
#+begin_src emacs-lisp :tangle yes
  (use-package embark)
#+end_src
** TODO [#B] Marginalia
#+begin_src emacs-lisp :tangle yes
  (use-package marginalia
    :init
    (marginalia-mode))
#+end_src
** TODO [#C] Mode Line
#+begin_src emacs-lisp :tangle no
  (setq-default mode-line-format
                '("%e" mode-line-front-space
                  (:propertize
                   ("" mode-line-mule-info mode-line-client mode-line-modified
                    mode-line-remote)
                   display (min-width (5.0)))
                  mode-line-frame-identification mode-line-buffer-identification "   "
                  mode-line-position (vc-mode vc-mode) "  "
                  mode-line-modes mode-line-misc-info mode-line-end-spaces))


  ;; (custom-set-faces '(mode-line ((t :background "CadetBlue4")))
  ;;                   '(mode-line-inactive ((t :background "CadetBlue4"))))
  ;; Meow state
  ;; read only state?
  ;; narrowed
  ;; buffer name / filename (colour for modified)
  ;; Mode
  ;; Git branch
  ;; Line/Column?
  ;; Flymake

  (defface cloveynit-mode-line-buffer-file-modified '((default :background "#6C3483" :weight bold))
    "Face for modified file buffers")

  (defface cloveynit-mode-line-buffer-file '((default :background "#34495E" :weight bold))
    "Face for file buffers")

  (defface cloveynit-mode-line-buffer-normal '((default :background "SpringGreen1" :weight bold))
    "Face for normal buffers")

  (defun cloveynit-mode-line--buffer-name ()
    (buffer-name))

  (defun cloveynit-mode-line--buffer-name-selected ()
    (let ((face (cond
                 ((and (buffer-file-name) (buffer-modified-p)) 'cloveynit-mode-line-buffer-file-modified)
                 ((buffer-file-name) 'cloveynit-mode-line-buffer-file)
                 (t 'cloveynit-mode-line-buffer-normal))))
      (propertize (cloveynit-mode-line--buffer-name) 'face face)))

  (defvar-local cloveynit-mode-line-buffer-name
      '(:eval
        (if (mode-line-window-selected-p)
            (cloveynit-mode-line--buffer-name-selected)
          (cloveynit-mode-line--buffer-name))))

  ;; (defun clover-mode-line-buffer ()
  ;;   (let ((face (cond
  ;; 	       ((and (buffer-file-name) (buffer-modified-p)) 'error)
  ;; 	       ((buffer-file-name) 'success)
  ;; 	       (t 'warning))))
  ;;     (format "%s" (propertize (buffer-name) 'face face))))

  (put 'cloveynit-mode-line-buffer-name 'risky-local-variable t)

  (setq-default mode-line-format
                '("" cloveynit-mode-line-buffer-name))
#+end_src
* Information Management
** TODO [#A] Hyperbole
#+begin_src emacs-lisp :tangle yes
  (use-package hyperbole
    :init (hyperbole-mode 1))
#+end_src
** TODO [#B] Org Mode
#+begin_src emacs-lisp :tangle yes
  (use-package org
    :config
    (setopt
     org-pretty-entities t
     org-startup-indented t
     org-src-window-setup 'other-window
     org-todo-keywords '((sequence "TODO(t)" "ACTIVE(a!)" "SCHEDULED(s@)" "HOLD(h@)" "|" "DONE(d@)" "CANCELED(c@)"))))
#+end_src
*** Modern
Styling package for org mode buffers.
#+begin_src emacs-lisp :tangle yes
  (use-package org-modern
    :hook (org-mode . org-modern-mode))
#+end_src
*** Modern Indent
#+begin_src emacs-lisp :tangle yes
  (use-package org-modern-indent
    :hook (org-mode . org-modern-indent-mode))
#+end_src
*** Agenda
#+begin_src emacs-lisp :tangle yes
  (use-package org-agenda
    :after org
    :config
    (setopt org-agenda-files `(,(expand-file-name "agenda/" "~/"))))
#+end_src
*** Babel
#+begin_src emacs-lisp :tangle yes
  (use-package ob-core
    :config
    (org-babel-do-load-languages
     'org-babel-load-languages
     '((emacs-lisp . t)
       (shell . t)))

    (defun cloveynit-org-confirm-babel-evaluate (lang body)
      "Custom confirmation function for evaluating code blocks.
  Check if `org-confirm-babel-evaluate` is set for the buffer.
  If not, prompt the user whether to allow running all code blocks silently."
      (unless (local-variable-p 'org-confirm-babel-evaluate)
        (if (yes-or-no-p "Run buffer code blocks without confirmation?")
            (setq-local org-confirm-babel-evaluate nil)
  	(setq-local org-confirm-babel-evaluate t)))
      org-confirm-babel-evaluate)

    (setopt org-confirm-babel-evaluate 'cloveynit-org-confirm-babel-evaluate))
#+end_src
**** TODO [#C] OB Mermaid

** Denote
Denote is a note taking package that works on one note per file and
uses the filename for all metadata. Benefit of this is that the notes
are easily processed and consumed using normal file management tools.

#+begin_src emacs-lisp :tangle yes
  (use-package denote
    :demand t
    :config
    (denote-rename-buffer-mode t)
    (setopt
     denote-directory (expand-file-name "notes/" "~/")
     denote-file-type 'org
     denote-date-prompt-use-org-read-date t)
    :hook (dired-mode . denote-dired-mode))
#+end_src

*** Denote Transient
#+begin_src emacs-lisp :tangle yes
  (transient-define-prefix cloveynit-denote-dispatch ()
    "Transient for Denote commands"
    [["Notes"
      ("n" "New" denote)
      ("c" "Region" denote-region)
      ("N" "Type" denote-type)
      ("d" "Date" denote-date)
      ("z" "Signature" denote-signature)
      ("t" "Template" denote-template)]
     ["Links"
      ("i" "Link" denote-link)
      ("I" "Add" denote-add-links)
      ("b" "Backlinks" denote-backlinks)
      ("f" "Find" denote-find-link)
      ("F" "Find Backlink" denote-find-backlink)]]
    [["File"
      ("r" "Rename" denote-rename-file)
      ("R" "Rename from front matter" denote-rename-file-using-front-matter)]
     ["Folder"
      ("s" "Search" cloveynit-find-file-in-notes)
      ("p" "Dired" (lambda () (interactive) (dired denote-directory)))]])
#+end_src
*** Find notes
Completing read function for finding and opening notes from the denote-directory
#+begin_src emacs-lisp :tangle yes
  (defun cloveynit-find-file-in-notes ()
    (interactive)
    "Open file from the denote notes directory"
    (let* ((vc-dirs-ignores (mapcar
                             (lambda (dir)
                               (concat dir "/"))
                             vc-directory-exclusion-list))
           (file (completing-read "Note:" (project--files-in-directory denote-directory vc-dirs-ignores))))
      (when file (find-file file))))
#+end_src
* Editing Enhancements
** Yasnippets
#+begin_src emacs-lisp :tangle yes
  (use-package yasnippet
    :init (yas-global-mode 1))
#+end_src

*** Yasnippets CAPF
#+begin_src emacs-lisp :tangle yes
  (use-package yasnippet-capf)
#+end_src
** Indent
*** Aggressive Indent
Keep running the indentation as typing occurs instead of only on
newlines.
#+begin_src emacs-lisp :tangle yes
  (use-package aggressive-indent
    :hook (emacs-lisp-mode . aggressive-indent-mode))
#+end_src
** TODO [#B] GPTel
#+begin_src emacs-lisp :tangle yes
  (use-package gptel
    :commands
    (gptel
     gptel-send
     gptel-menu)
    :config
    (setopt
     gptel-model "gpt-4o-mini"
     gptel-default-mode 'org-mode))
 #+end_src
** TODO [#B] Codeium
** TODO [#A] Format All
** TODO [#A] Treesitter
#+begin_src emacs-lisp :tangle yes
  (use-package treesit
    :defer t
    :init
    (defun cloveynit/report-unused-ts-modes ()
      "Report TreeSitter modes that are not mapped in major-mode-remap-alist or auto-mode-alist."
      (let ((ts-modes (apropos-internal "-ts-mode$" 'functionp)))
        (dolist (ts-mode ts-modes)
          (let ((used-in-major-mode-remap-alist
                 (seq-some (lambda (entry)
                             (equal ts-mode (cdr entry)))
                           major-mode-remap-alist))
                (used-in-auto-mode-alist
                 (seq-some (lambda (entry)
                             (equal ts-mode (cdr entry)))
                           auto-mode-alist))
  	      (excluded
  	       (seq-some (lambda (entry) (equal ts-mode entry))
  			 '(sh--redirect-bash-ts-mode))))
            (unless (or used-in-major-mode-remap-alist used-in-auto-mode-alist excluded)
              (warn "TS Mode not mapped: %s" ts-mode))))))

    :config
    (setopt
     treesit-font-lock-level 4
     treesit-extra-load-path `(,(expand-file-name "~/.config/emacs/var/tree-sitter"))
     major-mode-remap-alist '((sh-mode . bash-ts-mode)
    			    (c++-mode . c++-ts-mode)
    			    (c-or-c++-mode . c-or-c++-ts-mode)
    			    (c-mode . c-ts-mode)
    			    (cmake-mode . cmake-ts-mode)
    			    (csharp-mode . csharp-ts-mode)
    			    (css-mode . css-ts-mode)
    			    (indent-bars-mode . indent-bars-ts-mode)
    			    (java-mode . java-ts-mode)
    			    (javascript-mode . js-ts-mode)
    			    (js-json-mode . json-ts-mode)
    			    (nim-mode . nim-ts-mode)
    			    (python-mode . python-ts-mode)
    			    (ruby-mode . ruby-ts-mode)
    			    (conf-toml-mode . toml-ts-mode)))
    (dolist (mode-assoc
    	   '(("\\(?:Dockerfile\\(?:\\..*\\)?\\|\\.[Dd]ockerfile\\)\\'"
    	      . dockerfile-ts-mode)
    	     ("/go\\.mod\\'" . go-mod-ts-mode)
    	     ("\\.go\\'" . go-ts-mode)
  	     ("\\.nix\\'" . nix-ts-mode)
  	     ("\\.rs\\'" . rust-ts-mode)
  	     ("\\.ts\\'" . typescript-ts-mode)
  	     ("\\.tsx\\'" . tsx-ts-mode)
  	     ("\\.ya?ml\\'" . yaml-ts-mode)))
      (add-to-list 'auto-mode-alist mode-assoc))


    (cloveynit/report-unused-ts-modes))
#+end_src
** TODO [#B] Spelling
* Programming
** Flymake
#+begin_src emacs-lisp :tangle yes
  (use-package flymake
    :hook (prog-mode . flymake-mode))
#+end_src
** TODO [#A] Eglot
Will need to update Corfu for Eglot

** Eldoc
#+begin_src emacs-lisp :tangle yes
(use-package eldoc
  :config
  (setopt eldoc-documentation-strategy 'eldoc-documentation-compose-eagerly))
#+end_src

** Nix
#+begin_src emacs-lisp :tangle yes
  (use-package nix-ts-mode
    :mode "\\.nix\\'")
#+end_src

** Sh
#+begin_src emacs-lisp :tangle yes
  (use-package sh-script
    :init
    (setopt
     sh-shell "bash"
     sh-shell-file "bash"))
#+end_src

* Version Control
** Magit
#+begin_src emacs-lisp :tangle yes
  (use-package magit)
#+end_src
** TODO [#C] Diff-HL
* Project Management
** Project
Project is the in-built project management package.
#+begin_src emacs-lisp :tangle yes
  (defun cloveynit-project--dispact-wrap-command (cmd)
    "Wrap command CMD to optionally display buffer in another window."
    (interactive)
    (let ((display-buffer-overriding-action
           (if (transient-arg-value "other window" (transient-args transient-current-command))
               '(display-buffer-reuse-window (inhibit-same-window . t))
             display-buffer-overriding-action)))
      (call-interactively cmd)))

  (transient-define-prefix cloveynit-project-dispatch ()
    "Transient for project.el commands."
    [["Buffers and Files"
      ("B" "List Buffers" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-list-buffers)))
      ("b" "Consult Buffer" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'consult-project-buffer)))
      ("s" "Switch to Buffer" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-switch-to-buffer)))
      ("f" "Find File" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-find-file)))
      ("d" "Dired" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-dired)))
      ("F" "Find Directory" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-find-dir)))]
     ["Search and Replace"
      ("r" "Find Regexp" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-find-regexp)))
      ("q" "Query Replace" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-query-replace-regexp)))]
     ["Project Actions"
      ("c" "Compile" project-compile)
      ("e" "Eshell" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-eshell)))
      ("t" "Shell" (lambda () (interactive) (cloveynit-project--dispact-wrap-command 'project-shell)))
      ("x" "Shell Command" project-shell-command)
      ("a" "Async Shell Command" project-async-shell-command)
      ("v" "VC-Dir" project-vc-dir)
      ("m" "Magit Status" magit-project-status)]
     ["Manage Projects"
      ("S" "Switch Project" project-switch-project)
      ("k" "Kill Buffers" project-kill-buffers)
      ("p" "Forget Project" project-forget-project)
      ("P" "Forget Projects Under" project-forget-projects-under)
      ("z" "Forget Zombie Projects" project-forget-zombie-projects)
      ("R" "Remember Projects Under" project-remember-projects-under)]
     ["Options"
      ("o" "Force Display in Other Window" "other window")]])
#+end_src
* Utilities
** Helpful
Improved help display.
#+begin_src emacs-lisp :tangle yes
  (use-package helpful
    :commands
    (helpful-callable
     helpful-function
     helpful-macro
     helpful-command
     helpful-key
     helpful-variable
     helpful-at-point)
    :init
    (transient-define-prefix cloveynit-helpful-dispatch ()
      "Transient for Help commands"
      ["Helpful"
       [("c" "Callable" helpful-callable)
        ("f" "Function" helpful-function)
        ("x" "Command" helpful-command)
        ("m" "Macro" helpful-macro)
        ("k" "Key" helpful-key)
        ("v" "Variable" helpful-variable)
        ("p" "At point" helpful-at-point)]]))

#+end_src
** TODO [#A] Dired
#+begin_src emacs-lisp :tangle yes
  (defface cloveynit-dired-sub-transient-face
    '((t :foreground "orange" :weight bold))
    "Face for sub-transient commands.")

  (defun cloveynit-dired-highlight (name)
    "Helper function to highlight sub-transient commands."
    (propertize (concat name " >>") 'face 'cloveynit-dired-sub-transient-face))

  (transient-define-prefix cloveynit-dired-dispatch ()
    "Main transient for Dired commands."
    ["Dired Commands"

     ["File Opening"
      ("RET" "Find file" dired-find-file)
      ("C-o" "Display file" dired-display-file)
      ("+" "Create directory" dired-create-directory)
      ("=" "Diff" dired-diff)]

     ["File Management"
      ("C" "Copy" dired-do-copy)
      ("D" "Delete" dired-do-delete)
      ("R" "Rename" dired-do-rename)
      ("S" "Symlink" dired-do-symlink)
      ("Z" "Compress" dired-do-compress)
      ("c" "Compress to" dired-do-compress-to)
      ("B" "Byte compile" dired-do-byte-compile)]

     ["Advanced File Operations"
      ("H" "Hardlink" dired-do-hardlink)
      ("I" "Info" dired-do-info)
      ("L" "Load" dired-do-load)
      ("N" "Man" dired-do-man)
      ("O" "Change owner" dired-do-chown)
      ("G" "Change group" dired-do-chgrp)
      ("W" "Browse URL" browse-url-of-dired-file)
      ("Y" "Relsymlink" dired-do-relsymlink)]

     ["Marking and Flagging"
      ("m" "Mark" dired-mark)
      ("u" "Unmark" dired-unmark)
      ("t" "Toggle marks" dired-toggle-marks)
      ("d" "Flag file deletion" dired-flag-file-deletion)
      ("#" "Flag auto-save files" dired-flag-auto-save-files)
      ("~" "Flag backup files" dired-flag-backup-files)
      ("x" "Delete flagged" dired-do-flagged-delete)
      ("U" "Unmark all" dired-unmark-all-marks)
      ("DEL" "Unmark backward" dired-unmark-backward)
      ("*" (lambda () (cloveynit-dired-highlight "Marking commands")) cloveynit-dired-marking)]

     ["File Viewing"
      ("v" "View file" dired-view-file)
      ("o" "Open in other window" dired-find-file-other-window)
      ("a" "Find alternate file" dired-find-alternate-file)
      ("y" "Show file type" dired-show-file-type)]

     ["Directory Navigation"
      ("^" "Up directory" dired-up-directory)
      ("<" "Previous dirline" dired-prev-dirline)
      (">" "Next dirline" dired-next-dirline)
      ("i" "Insert subdir" dired-maybe-insert-subdir)
      ("j" "Goto file" dired-goto-file)
      ("k" "Kill lines" dired-do-kill-lines)
      ("g" "Revert buffer" revert-buffer)
      ("s" "Sort toggle" dired-sort-toggle-or-edit)
      ("." "Clean directory" dired-clean-directory)
      ("$" "Hide subdir" dired-hide-subdir)
      ("(" "Hide details" dired-hide-details-mode)]

     ["Special Operations"
      ("A" "Find regexp" dired-do-find-regexp)
      ("Q" "Find regexp & replace" dired-do-find-regexp-and-replace)
      ("X" "Shell command" dired-do-shell-command)
      ("&" "Async shell command" dired-do-async-shell-command)
      ("%" (lambda () (cloveynit-dired-highlight "Regexp commands")) cloveynit-dired-regexp)]

     ["Image Dired"
      ("C-t" (lambda () (cloveynit-dired-highlight "Image Dired commands")) cloveynit-dired-image-dired)]])

  (transient-define-prefix cloveynit-dired-image-dired ()
    "Transient for Image Dired commands."
    ["Image Dired Commands"
     ("C-t" "Toggle marked thumbs" image-dired-dired-toggle-marked-thumbs)
     ("." "Display thumb" image-dired-display-thumb)
     ("a" "Append thumbs" image-dired-display-thumbs-append)
     ("c" "Comment files" image-dired-dired-comment-files)
     ("d" "Display thumbs" image-dired-display-thumbs)
     ("e" "Edit comment/tags" image-dired-dired-edit-comment-and-tags)
     ("f" "Mark tagged files" image-dired-mark-tagged-files)
     ("i" "Display image" image-dired-dired-display-image)
     ("j" "Jump to thumb buffer" image-dired-jump-thumbnail-buffer)
     ("r" "Delete tag" image-dired-delete-tag)
     ("t" "Tag files" image-dired-tag-files)
     ("x" "Display external" image-dired-dired-display-external)])

  (transient-define-prefix cloveynit-dired-marking ()
    "Transient for Dired Marking commands."
    ["Dired Marking Commands"
     ("!" "Unmark all marks" dired-unmark-all-marks)
     ("%" "Mark files regexp" dired-mark-files-regexp)
     ("*" "Mark executables" dired-mark-executables)
     ("/" "Mark directories" dired-mark-directories)
     ("?" "Unmark all files" dired-unmark-all-files)
     ("@" "Mark symlinks" dired-mark-symlinks)
     ("N" "Number of marked files" dired-number-of-marked-files)
     ("c" "Change marks" dired-change-marks)
     ("m" "Mark files" dired-mark)
     ("s" "Mark subdir files" dired-mark-subdir-files)
     ("t" "Toggle marks" dired-toggle-marks)
     ("u" "Unmark" dired-unmark)
     ("DEL" "Unmark backward" dired-unmark-backward)])

  (transient-define-prefix cloveynit-dired-regexp ()
    "Transient for Dired Regexp commands."
    ["Dired Regexp Commands"
     ("&" "Flag garbage files" dired-flag-garbage-files)
     ("C" "Copy regexp" dired-do-copy-regexp)
     ("H" "Hardlink regexp" dired-do-hardlink-regexp)
     ("R" "Rename regexp" dired-do-rename-regexp)
     ("S" "Symlink regexp" dired-do-symlink-regexp)
     ("Y" "Relsymlink regexp" dired-do-relsymlink-regexp)
     ("d" "Flag files regexp" dired-flag-files-regexp)
     ("g" "Mark files with regexp" dired-mark-files-containing-regexp)
     ("l" "Downcase" dired-downcase)
     ("m" "Mark files regexp" dired-mark-files-regexp)
     ("r" "Rename regexp" dired-do-rename-regexp)
     ("u" "Upcase" dired-upcase)])
#+end_src
** TODO [#A] Ediff
* Custom Functions
